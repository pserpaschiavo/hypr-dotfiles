#!/bin/bash

# ============================================================================
#  üöÄ HYPRLAND ULTIMATE SETUP ORCHESTRATOR üöÄ
# ============================================================================
# Este script orquestra TODA a instala√ß√£o e configura√ß√£o do ambiente Hyprland
# 
# Executa em ordem:
# 1. Depend√™ncias do sistema
# 2. Cursores Nordzy
# 3. Aplica√ß√µes CLI
# 4. Wallust (temas din√¢micos)
# 5. Symlinks de configura√ß√µes
# 6. SDDM (display manager)
# 7. Auto-login (opcional)
# 8. Configura√ß√£o de boot do Hyprland
# 9. Valida√ß√£o final
#
# Autor: Phil's Dotfiles
# ============================================================================

set -e  # Exit on error

# ============================================================================
# CORES E FUN√á√ïES DE LOG
# ============================================================================

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# Banner ASCII
show_banner() {
    clear
    echo -e "${MAGENTA}"
    cat << "EOF"
‚ï¶ ‚ï¶‚î¨ ‚î¨‚îå‚îÄ‚îê‚î¨‚îÄ‚îê‚î¨  ‚îå‚îÄ‚îê‚îå‚îê‚îå‚îå‚î¨‚îê  ‚ï¶ ‚ï¶‚î¨ ‚îå‚î¨‚îê‚î¨‚îå‚î¨‚îê‚îå‚îÄ‚îê‚îå‚î¨‚îê‚îå‚îÄ‚îê
‚ï†‚ïê‚ï£‚îî‚î¨‚îò‚îú‚îÄ‚îò‚îú‚î¨‚îò‚îÇ  ‚îú‚îÄ‚î§‚îÇ‚îÇ‚îÇ ‚îÇ‚îÇ  ‚ïë ‚ïë‚îÇ  ‚îÇ ‚îÇ‚îÇ‚îÇ‚îÇ‚îÇ‚îú‚îÄ‚î§ ‚îÇ ‚îú‚î§ 
‚ï© ‚ï© ‚î¥ ‚î¥  ‚î¥‚îî‚îÄ‚î¥‚îÄ‚îò‚î¥ ‚î¥‚îò‚îî‚îò‚îÄ‚î¥‚îò  ‚ïö‚ïê‚ïù‚î¥‚îÄ‚îò‚î¥ ‚î¥‚î¥ ‚î¥‚î¥‚î¥ ‚î¥ ‚î¥ ‚îî‚îÄ‚îò
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë     SETUP COMPLETO E AUTOM√ÅTICO                 ‚ïë
‚ïë     Instala e configura TUDO!                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "${NC}"
    echo ""
}

log_header() {
    echo ""
    echo -e "${BLUE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${BLUE}‚ïë${NC} ${WHITE}$1${NC}"
    echo -e "${BLUE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

log_step() {
    echo -e "${CYAN}[‚óè]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[‚úì]${NC} $1"
}

log_error() {
    echo -e "${RED}[‚úó]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[!]${NC} $1"
}

log_info() {
    echo -e "${BLUE}[i]${NC} $1"
}

# Confirma√ß√£o do usu√°rio
ask_confirmation() {
    local question="$1"
    local default="${2:-n}"
    
    if [ "$default" = "y" ]; then
        echo -ne "${YELLOW}$question [Y/n]:${NC} "
    else
        echo -ne "${YELLOW}$question [y/N]:${NC} "
    fi
    
    read -r response
    
    if [ -z "$response" ]; then
        response="$default"
    fi
    
    case "$response" in
        [yY][eE][sS]|[yY]) 
            return 0
            ;;
        *)
            return 1
            ;;
    esac
}

# ============================================================================
# VERIFICA√á√ïES INICIAIS
# ============================================================================

check_prerequisites() {
    log_header "üîç VERIFICA√á√ïES INICIAIS"
    
    # Verificar se est√° no diret√≥rio correto
    if [ ! -f "$(pwd)/scripts/orchestrator.sh" ]; then
        log_error "Execute este script de dentro do diret√≥rio Dotfiles!"
        log_info "cd ~/Dotfiles && ./scripts/orchestrator.sh"
        exit 1
    fi
    
    log_success "Diret√≥rio correto"
    
    # Verificar Arch Linux
    if [ ! -f /etc/arch-release ]; then
        log_warning "Este script foi feito para Arch Linux"
        if ! ask_confirmation "Continuar mesmo assim?"; then
            exit 0
        fi
    else
        log_success "Sistema: Arch Linux"
    fi
    
    # Verificar yay
    if ! command -v yay &> /dev/null; then
        log_error "yay n√£o encontrado!"
        log_info "Instale yay primeiro: https://github.com/Jguer/yay"
        exit 1
    fi
    log_success "yay instalado"
    
    # Verificar git
    if ! command -v git &> /dev/null; then
        log_error "git n√£o encontrado!"
        exit 1
    fi
    log_success "git instalado"
    
    echo ""
}

# ============================================================================
# BACKUP
# ============================================================================

backup_existing_configs() {
    log_header "üì¶ BACKUP DE CONFIGURA√á√ïES EXISTENTES"
    
    BACKUP_DIR="$HOME/.config-backup-$(date +%Y%m%d_%H%M%S)"
    
    local has_configs=false
    
    for dir in hypr waybar dunst rofi ghostty wallust; do
        if [ -d "$HOME/.config/$dir" ] && [ ! -L "$HOME/.config/$dir" ]; then
            if [ "$has_configs" = false ]; then
                mkdir -p "$BACKUP_DIR"
                has_configs=true
            fi
            log_step "Backup: ~/.config/$dir"
            cp -r "$HOME/.config/$dir" "$BACKUP_DIR/"
        fi
    done
    
    if [ "$has_configs" = true ]; then
        log_success "Backup salvo em: $BACKUP_DIR"
    else
        log_info "Nenhuma configura√ß√£o anterior encontrada"
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 1: SISTEMA BASE
# ============================================================================

install_phase1_system() {
    log_header "üì¶ FASE 1: DEPEND√äNCIAS DO SISTEMA"
    
    if [ -f "scripts/install-phase1.sh" ]; then
        log_step "Executando install-phase1.sh..."
        bash scripts/install-phase1.sh
        log_success "Fase 1 completa"
    else
        log_error "Script install-phase1.sh n√£o encontrado!"
        exit 1
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 2: CURSORES
# ============================================================================

install_phase2_cursors() {
    log_header "üñ±Ô∏è  FASE 2: CURSORES NORDZY"
    
    if [ -f "scripts/setup-cursors.sh" ]; then
        log_step "Executando setup-cursors.sh..."
        bash scripts/setup-cursors.sh
        log_success "Fase 2 completa"
    else
        log_warning "Script setup-cursors.sh n√£o encontrado (opcional)"
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 3: APLICA√á√ïES CLI
# ============================================================================

install_phase3_cli_apps() {
    log_header "üñ•Ô∏è  FASE 3: APLICA√á√ïES CLI"
    
    if [ -f "scripts/install-cli-apps.sh" ]; then
        log_step "Executando install-cli-apps.sh..."
        bash scripts/install-cli-apps.sh
        log_success "Fase 3 completa"
    else
        log_warning "Script install-cli-apps.sh n√£o encontrado (opcional)"
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 4: WALLUST
# ============================================================================

install_phase4_wallust() {
    log_header "üé® FASE 4: WALLUST (TEMAS DIN√ÇMICOS)"
    
    if [ -f "scripts/setup-wallust.sh" ]; then
        log_step "Executando setup-wallust.sh..."
        bash scripts/setup-wallust.sh
        log_success "Fase 4 completa"
    else
        log_warning "Script setup-wallust.sh n√£o encontrado (opcional)"
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 5: SYMLINKS
# ============================================================================

create_symlinks() {
    log_header "üîó FASE 5: CRIANDO SYMLINKS"
    
    DOTFILES_DIR="$(pwd)"
    
    # Array de configura√ß√µes
    declare -A configs=(
        ["hypr"]="$DOTFILES_DIR/hypr/.config/hypr"
        ["waybar"]="$DOTFILES_DIR/waybar/.config/waybar"
        ["dunst"]="$DOTFILES_DIR/dunst/.config/dunst"
        ["rofi"]="$DOTFILES_DIR/rofi/.config/rofi"
        ["ghostty"]="$DOTFILES_DIR/ghostty/.config/ghostty"
        ["wallust"]="$DOTFILES_DIR/wallust/.config/wallust"
        ["hyprpaper"]="$DOTFILES_DIR/hyprpaper/.config/hyprpaper"
    )
    
    for name in "${!configs[@]}"; do
        source_dir="${configs[$name]}"
        target_dir="$HOME/.config/$name"
        
        if [ -d "$source_dir" ]; then
            # Remove existing (if not symlink)
            if [ -d "$target_dir" ] && [ ! -L "$target_dir" ]; then
                log_warning "Removendo diret√≥rio existente: $target_dir"
                rm -rf "$target_dir"
            elif [ -L "$target_dir" ]; then
                log_info "Symlink j√° existe: $name"
                rm "$target_dir"
            fi
            
            # Create symlink
            ln -sf "$source_dir" "$target_dir"
            log_success "Symlink criado: $name"
        else
            log_warning "Diret√≥rio n√£o encontrado: $source_dir"
        fi
    done
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 6: SDDM
# ============================================================================

setup_sddm() {
    log_header "üñ•Ô∏è  FASE 6: DISPLAY MANAGER (SDDM)"
    
    if ask_confirmation "Instalar e configurar SDDM?"; then
        if [ -f "scripts/setup-sddm.sh" ]; then
            log_step "Executando setup-sddm.sh..."
            bash scripts/setup-sddm.sh
            log_success "SDDM configurado"
        else
            log_warning "Script setup-sddm.sh n√£o encontrado"
        fi
    else
        log_info "SDDM ignorado"
    fi
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 7: SEGURAN√áA (LOGIN COM SENHA)
# ============================================================================

setup_secure_login() {
    log_header "üîê FASE 7: CONFIGURA√á√ÉO DE LOGIN SEGURO"
    
    log_success "Senha obrigat√≥ria habilitada (padr√£o)"
    log_info "SDDM sempre pedir√° senha ao iniciar"
    
    # Garantir que n√£o existe configura√ß√£o de auto-login
    if [ -f /etc/sddm.conf.d/autologin.conf ]; then
        log_step "Removendo configura√ß√£o de auto-login anterior..."
        sudo rm -f /etc/sddm.conf.d/autologin.conf
        log_success "Auto-login desabilitado"
    fi
    
    # Garantir que Hyprland seja a sess√£o padr√£o (mas n√£o auto-login)
    if [ -f /etc/sddm.conf ]; then
        # Remover qualquer linha de auto-login se existir
        sudo sed -i '/\[Autologin\]/d' /etc/sddm.conf
        sudo sed -i '/^User=/d' /etc/sddm.conf
        sudo sed -i '/^Session=/d' /etc/sddm.conf
    fi
    
    log_success "Login seguro configurado"
    log_info "Ao reiniciar, SDDM pedir√° usu√°rio e senha"
    
    echo ""
}

# ============================================================================
# INSTALA√á√ÉO - FASE 8: HYPRLAND COMO PADR√ÉO
# ============================================================================

setup_hyprland_default() {
    log_header "üéØ FASE 8: HYPRLAND COMO SESS√ÉO PADR√ÉO"
    
    # Verificar se Hyprland est√° instalado
    if ! command -v Hyprland &> /dev/null; then
        log_error "Hyprland n√£o est√° instalado!"
        log_info "Execute a Fase 1 primeiro"
        return 1
    fi
    
    log_success "Hyprland instalado"
    
    # Verificar session file
    if [ ! -f /usr/share/wayland-sessions/hyprland.desktop ]; then
        log_warning "Arquivo de sess√£o n√£o encontrado, criando..."
        
        sudo tee /usr/share/wayland-sessions/hyprland.desktop > /dev/null <<EOF
[Desktop Entry]
Name=Hyprland
Comment=An intelligent dynamic tiling Wayland compositor
Exec=Hyprland
Type=Application
EOF
        log_success "Arquivo de sess√£o criado"
    else
        log_success "Arquivo de sess√£o existe"
    fi
    
    # Verificar SDDM
    if systemctl is-enabled sddm &> /dev/null; then
        log_success "SDDM est√° habilitado"
        
        # Configurar sess√£o padr√£o no SDDM
        if [ -f /etc/sddm.conf ]; then
            if ! grep -q "Session=hyprland" /etc/sddm.conf; then
                log_step "Configurando Hyprland como sess√£o padr√£o..."
                sudo sed -i '/\[Autologin\]/a Session=hyprland' /etc/sddm.conf
            fi
        fi
    else
        log_info "SDDM n√£o est√° habilitado"
    fi
    
    log_success "Hyprland configurado como sess√£o padr√£o"
    echo ""
}

# ============================================================================
# RECARREGAR APLICA√á√ïES
# ============================================================================

reload_applications() {
    log_header "üîÑ RECARREGANDO APLICA√á√ïES"
    
    # Waybar
    if pgrep -x waybar > /dev/null; then
        log_step "Recarregando Waybar..."
        pkill -SIGUSR2 waybar
        log_success "Waybar recarregado"
    fi
    
    # Dunst
    if pgrep -x dunst > /dev/null; then
        log_step "Recarregando Dunst..."
        pkill dunst && dunst &>/dev/null &
        log_success "Dunst recarregado"
    fi
    
    # Hyprland (se estiver rodando)
    if pgrep -x Hyprland > /dev/null; then
        log_step "Recarregando Hyprland..."
        hyprctl reload &>/dev/null
        log_success "Hyprland recarregado"
    fi
    
    echo ""
}

# ============================================================================
# VALIDA√á√ÉO FINAL
# ============================================================================

validate_installation() {
    log_header "‚úÖ VALIDA√á√ÉO FINAL"
    
    local errors=0
    
    # Verificar Hyprland
    if command -v Hyprland &> /dev/null; then
        log_success "Hyprland instalado"
    else
        log_error "Hyprland N√ÉO instalado"
        ((errors++))
    fi
    
    # Verificar configura√ß√µes
    for dir in hypr waybar dunst rofi ghostty; do
        if [ -L "$HOME/.config/$dir" ]; then
            log_success "Configura√ß√£o: $dir"
        else
            log_warning "Configura√ß√£o ausente: $dir"
        fi
    done
    
    # Verificar scripts
    if [ -x "scripts/change-wallpaper.sh" ]; then
        log_success "Scripts execut√°veis"
    fi
    
    # Verificar SDDM
    if systemctl is-enabled sddm &> /dev/null; then
        log_success "SDDM habilitado"
    else
        log_warning "SDDM n√£o habilitado (inicializa√ß√£o manual necess√°ria)"
    fi
    
    echo ""
    
    if [ $errors -eq 0 ]; then
        return 0
    else
        return 1
    fi
}

# ============================================================================
# RESUMO FINAL
# ============================================================================

show_final_summary() {
    echo ""
    echo -e "${GREEN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${GREEN}‚ïë                                                            ‚ïë${NC}"
    echo -e "${GREEN}‚ïë          ‚ú® INSTALA√á√ÉO COMPLETA! ‚ú®                        ‚ïë${NC}"
    echo -e "${GREEN}‚ïë                                                            ‚ïë${NC}"
    echo -e "${GREEN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
    
    log_info "O que foi instalado:"
    echo "   ‚úì Hyprland + Wayland"
    echo "   ‚úì Waybar (barras personalizadas)"
    echo "   ‚úì Rofi (launcher com 5 menus)"
    echo "   ‚úì Dunst (notifica√ß√µes)"
    echo "   ‚úì Ghostty (terminal)"
    echo "   ‚úì Nordzy Cursors"
    echo "   ‚úì 30+ apps CLI"
    echo "   ‚úì Wallust (temas din√¢micos)"
    echo "   ‚úì SDDM (display manager)"
    echo ""
    
    log_info "Pr√≥ximos passos:"
    echo ""
    echo "   1. ${CYAN}Reinicie o sistema:${NC}"
    echo "      ${WHITE}sudo reboot${NC}"
    echo ""
    echo "   2. ${CYAN}No SDDM:${NC}"
    echo "      ‚Ä¢ Digite seu usu√°rio e senha üîê"
    echo "      ‚Ä¢ Selecione 'Hyprland' no menu de sess√£o"
    echo ""
    echo "   3. ${CYAN}Teste os atalhos:${NC}"
    echo "      SUPER + R         ‚Üí Rofi launcher"
    echo "      SUPER + SHIFT + S ‚Üí Menu Sistema"
    echo "      SUPER + W         ‚Üí Mudar wallpaper"
    echo ""
    echo "   4. ${CYAN}Leia a documenta√ß√£o:${NC}"
    echo "      bat ~/Dotfiles/KEYBINDINGS.md"
    echo "      bat ~/Dotfiles/WALLUST_GUIDE.md"
    echo ""
    
    log_warning "IMPORTANTE:"
    echo "   ‚Ä¢ Login sempre requer senha (configura√ß√£o segura) üîê"
    echo "   ‚Ä¢ Adicione wallpapers em: ~/Pictures/Wallpapers/"
    echo "   ‚Ä¢ Configure aliases no .zshrc: source ~/.zshrc"
    echo ""
    
    echo -e "${MAGENTA}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo -e "${MAGENTA}         Feito com üíô para um Hyprland incr√≠vel!            ${NC}"
    echo -e "${MAGENTA}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
}

# ============================================================================
# MAIN - EXECU√á√ÉO PRINCIPAL
# ============================================================================

main() {
    show_banner
    
    log_info "Este script ir√°:"
    echo "  ‚Ä¢ Instalar TODAS as depend√™ncias"
    echo "  ‚Ä¢ Configurar TODO o ambiente"
    echo "  ‚Ä¢ Criar TODOS os symlinks"
    echo "  ‚Ä¢ Configurar boot autom√°tico do Hyprland"
    echo ""
    
    if ! ask_confirmation "Continuar com a instala√ß√£o completa?" "y"; then
        log_info "Instala√ß√£o cancelada"
        exit 0
    fi
    
    # Verifica√ß√µes
    check_prerequisites
    
    # Backup
    backup_existing_configs
    
    # Instala√ß√£o em fases
    install_phase1_system
    install_phase2_cursors
    install_phase3_cli_apps
    install_phase4_wallust
    
    # Configura√ß√£o
    create_symlinks
    setup_sddm
    setup_secure_login
    setup_hyprland_default
    
    # Finaliza√ß√£o
    reload_applications
    validate_installation
    
    # Resumo
    show_final_summary
}

# ============================================================================
# EXECUTAR
# ============================================================================

main "$@"
